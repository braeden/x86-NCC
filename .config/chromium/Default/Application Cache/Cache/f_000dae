function cUb(a,b,c,d){var e=null;a.j.every(function(a,h,l){if(b&&(h>c||h==c&&l>=d))return!1;a.isEmpty()||(e=new G(l,h));return!0});return e}function dUb(a,b,c){var d=null;a.j.some(function(a,f,h){return(f>b||f==b&&h>c)&&!a.isEmpty()?(d=new G(h,f),!0):!1});return d}function eUb(a,b,c){var d=0,e=-1;b&&(d=b.y,e=b.x);var f=null;return f=c?cUb(a,!!b,d,e):dUb(a,d,e)}
function fUb(a,b){if(!b)return null;var c=null;a.j.some(function(a,e,f){a=a.sd();for(var h=0;h<a.length;h++)if(a[h]==b)return c=new G(f,e),!0;return!1});return c}function gUb(a){var b=new gd;a.j.forEach(function(a){a.isEmpty()||hd(b,a.sd())});return b.sd()}function hUb(a,b){var c=a.j.fe(b.y,b.x);return c?c.sd():[]}function iUb(a,b){var c=Ss(a.k);Tb(a.L,function(a,e){var f=this.B.Jo(a);Number(e)==c&&b?mm(f,"docs-icon-comment-blank-highlighted"):om(f,"docs-icon-comment-blank-highlighted")},a)}
function d7(a){return a.j.hasUnpostedDocos()}function jUb(a,b){for(var c=[],d=0;d<b.length;d++)c.push(a.k.j[b[d]]||0);a.j.deleteDocoPositions(c)}function kUb(a,b){var c={},d;for(d in b){var e=a.k.j[d]||0;e&&a.j.hasDoco(e)&&(c[e]=b[d])}return c}function lUb(a){return a.j};function mUb(a){this.j={};if(a)for(var b in a)this.set(b,a[b])}mUb.prototype.get=function(a){if(!(a in this.j))throw Error("No value for key "+a);return this.j[a]};mUb.prototype.set=function(a,b){this.j[a]=b};function nUb(a){this.j=new mUb;this.o=a||null}nUb.prototype.k=function(a){try{var b=Rd(a)}catch(c){return this.o&&this.o.log(Error("Invalid serialized anchor ID")),null}return this.j.get(b.type).j(b)};nUb.prototype.bd=function(a){return Td(this.j.get(a.getType()).bd(a))};function e7(a,b){this.o=a;this.k=b}e7.prototype.getType=g("o");function f7(a){e7.call(this,"range",0);this.q=a}B(f7,e7);f7.prototype.j=g("q");function oUb(){}ia(oUb);oUb.prototype.j=function(a){return new f7(a.range)};oUb.prototype.bd=function(a){var b={};b.type=a.getType();b.uid=a.k;b.range=a.j();return b};function pUb(a,b){e7.call(this,"workbook-range",0);this.A=a;this.q=!!b}B(pUb,e7);pUb.prototype.j=g("A");function qUb(){}ia(qUb);qUb.prototype.j=function(a){return new pUb(a.range)};qUb.prototype.bd=function(a){var b={};b.type=a.q?"range":"workbook-range";b.uid=a.k;b.range=a.j();return b};function g7(){nUb.call(this);var a=oUb.getInstance();this.j.set("range",a);a=qUb.getInstance();this.j.set("workbook-range",a)}B(g7,nUb);ia(g7);g7.prototype.k=function(a){return(a=g7.G.k.call(this,a))?a:null};function h7(a,b){if(!b)return null;var c=b.j();return"range"==b.getType()?(c=a.j[c],rUb(c)?c.fb().Ed():null):(c=sUb(b))&&tUb(uUb(c))?uUb(c).Ed():null}function sUb(a){var b=new uo,c;try{c=ritz.getWorkbookRangeById(a.j(),!0)}catch(d){}return c?b.Mj((new Li).aa(),ritz.getWorkbookRangeById(a.j(),!0)):null}function uUb(a){return new Bf(a.gb(),a.ib(),a.zb(),a.Cb())}
function i7(a,b,c){return c?"range"==c.getType()?(b=b.j[c.j()],rUb(b)?(b=b.qb(),null!=b?vUb(a,b):null):null):(b=sUb(c))&&tUb(uUb(b))?vUb(a,parseInt(b.hb(),10)):null:null}function vUb(a,b){var c=eu(a,b);return c?c.Vb():null}function rUb(a){return!!a&&a.j&&tUb(a.fb())}function tUb(a){return!!a&&1==a.height&&1==a.width&&Uf(a)};function wUb(a,b,c,d,e,f,h,l,m,n,p){K.call(this);this.q=a;this.wa=b;this.Y=c;this.xa=d;this.C=e;this.Ta=f;this.o=h;this.Ea=l;this.j=m;this.O=n;this.B=b.R;this.k=b.j;this.A=b.A;this.F=g7.getInstance();this.L={};this.I=new gd;this.R=new dt(0);a=[this.R];Gb(p.k,a);KVa(p,a);p.j=JVa(p.k);JN(p);this.H=new R(this);xUb(this)}B(wUb,K);t=wUb.prototype;t.u9=!1;
function xUb(a){var b=lb(Zt,function(a){return!xua[a]});a.H.D(a.xa,"activity-box-closed",a.URa).D(a.C,"mouseover",j7(a,a.LXa)).D(a.C,"click",j7(a,a.JXa)).D(a.C,"selectionChange",j7(a,a.MXa)).D(a.C,"inputBoxActivate",j7(a,a.HXa)).D(a.C,"hide_docos",j7(a,a.KXa)).D(a.k,"b",j7(a,a.Ibb)).D(a.o,"view-comments",a.LVa).D(a.o,"comment-indicator-hover-start",a.JVa).D(a.o,"comment-indicator-hover-end",a.IVa).D(a.C,"insert_doco",a.Fbb).D(new bv(a.Ea),"mousewheel",a.Gbb).D(a.A,["add_named_range","delete_named_range"],
a.zSa).D(a.wa,"docos_change",a.QXa).D(a.O,"qe",a.qLa).D(a.k,"a",a.Tka);var c=Av(a.k);a.H.D(c,b,a.IXa);a.H.D(c,["Fa"],j7(a,a.Hbb));CJ(a.q,Docos.EventType.HOVER,j7(a,a.YNa));CJ(a.q,Docos.EventType.SELECTED,j7(a,a.Ebb));CJ(a.q,Docos.EventType.CREATED,a.Aja,a);CJ(a.q,Docos.EventType.UNRESOLVED,a.Aja,a);CJ(a.q,Docos.EventType.DELETED,a.Bja,a);CJ(a.q,Docos.EventType.RESOLVED,a.Bja,a);CJ(a.q,Docos.EventType.POSTED,a.rOa,a);CJ(a.q,Docos.EventType.PENDING,a.qTa,a);U.Uq.nd(vr,A(a.CQa,a));T.Os.nd(vr,A(a.hLa,
a));T.oP.subscribe("action",A(a.qSa,a));T.pP.subscribe("action",A(a.xSa,a));T.qP.subscribe("action",A(a.ySa,a));a.Tka()}t.Tka=function(){var a=LK(this.k);T.oP.Z(a);T.pP.Z(a);T.qP.Z(a)};t.CQa=function(){this.q.setOption(Docos.OptionName.READONLY,!this.wa.Fp())};function j7(a,b){return A(function(a){this.u9||b.call(this,a)},a)}
t.Fbb=function(){var a,b=SD(this.k),c=Hw(b);c&&!d7(this.q)&&!yUb(this,b,c)&&(a=mfb(this.A),this.Ta.Xb(new Ls(this.A,a,a,b.qb(),Ef(c),this.k,!0)),a=this.F.bd(new f7(a)),a=k7(this,a))&&(this.j.dispatchEvent(new l7("ye",[a],c)),this.Y.j(2))};function yUb(a,b,c){c=hUb(OD(a.B,b),c);return c.length?(b=a.q,a=a.F.bd(c[0]),b.j.highlightDoco(b.k.j[a]||0,!0),!0):!1}t.Aja=function(a){D(a.j,function(a){m7(this,!0,a);this.I.add(a)},this)};t.Bja=function(a){D(a.j,function(a){m7(this,!1,a);this.I.remove(a)},this)};
function m7(a,b,c,d,e){c=k7(a,c);d=d||i7(a.k,a.A,c);e=e||h7(a.A,c);if(c&&d&&e){var f=OD(a.B,d);if(b){var h=f.j.fe(e.y,e.x)||new gd;h.add(c);Cv(f.j,e.y,e.x,h)}else(h=f.j.fe(e.y,e.x))&&h.remove(c);Cv(f.k,e.y,e.x,!0);f.q.vb()||f.q.start();a.k.getActiveGrid()&&(d=d==SD(a.k),b?(a=a.j,(b=d?e:null)&&qf(b,a.dG)&&a.j.add(c),a.dispatchEvent(new l7("re",[c],b))):(a=a.j,(b=d?e:null)&&qf(b,a.dG)&&a.j.remove(c),a.Bq==c&&(a.Bq=null),a.dispatchEvent(new l7("Ae",[c],b))))}else a.j.dispatchEvent("Ce")}
function k7(a,b){if(!b)return null;if(!a.L[b]){var c=a.F.k(b);c&&(a.L[b]=c)}return a.L[b]}t.Ibb=function(){this.j.reset()};t.YNa=function(a){a=k7(this,a.j.length?a.j[0]:null);var b=h7(this.A,a);this.j.dispatchEvent(new l7("ve",[a],b))};t.rOa=ba();t.qTa=function(){var a=this.R,b=this.q.j.hasPendingContent();Aq(a,Bq(a.ba,4,b))};t.URa=function(){this.Y.j(3)};
t.Ebb=function(a){if(!d7(this.q)){var b=k7(this,a.j.length?a.j[0]:null),c=h7(this.A,b);b&&c?(this.u9=!0,zUb(this.j,b,c)):b||a.q?this.j.reset():b||this.Y.j(3)}};t.qLa=function(){this.u9=!1};t.KXa=function(){this.j.dispatchEvent("xe")};t.MXa=function(){if(!this.O.isEmpty()&&!d7(this.q)){this.Y.j(3);var a=this.j,b=Hw(SD(this.k));qf(a.DH,b)||!a.Bq&&!a.Sj&&qf(a.dG,b)||(n7(a),a.dispatchEvent(new l7("ue",[],b)))}};
t.JXa=function(){var a=SD(this.k);if(!d7(this.q)&&a){var b=OD(this.B,a),c=(a=Hw(a))?hUb(b,a):[];c.length&&(b=this.j,c=c[0],qf(b.DH,a)?(n7(b),b.dispatchEvent(new l7("se",[],a))):b.dispatchEvent(new l7("se",[c],a)))}};t.HXa=function(){d7(this.q)||this.j.reset()};t.Hbb=function(){AUb(this.j)};t.IXa=function(){AUb(this.j)};
t.zSa=function(a){var b=a.Ge;if(b&&b.j)if(rUb(b)){var c;c=b.getId();c=this.F.bd(new f7(c));a="add_named_range"==a.type;if(!a||this.I.contains(c)){var d=b.qb();b.Ne()&&null!=d&&(d=vUb(this.k,d))&&m7(this,a,c,d,b.fb().Ed())}}else this.j.dispatchEvent("Ce")};
t.QXa=function(a){a=a.docos||[];Ib(a);for(var b=0;b<a.length;b++){var c=this.F.bd(new pUb(a[b]));if(c){var d=k7(this,c),e;a:{e=this.B;if(d){var f=void 0;for(f in e.j){var h=e.j[f],l=fUb(h,d);if(l){e={Ua:h.Vb(),coord:l};break a}}}e=null}e?(m7(this,!1,c,e.Ua,e.coord),m7(this,!0,c),this.j.dispatchEvent("Ce")):this.I.contains(c)&&m7(this,!0,c)}}};
t.LXa=function(a){var b=SD(this.k);if(b){if((a=a.Fh)&&!Cy(a)){var c=Al(b,a.y,a.x);a=c?c.Ed():a}else a=null;b=OD(this.B,b);b=a?hUb(b,a):[];c=this.j;c.j.clear();hd(c.j,b);c.dG=a;c.dispatchEvent(new l7("te",b,a))}};t.LVa=function(){if(!d7(this.q)){var a=this.j;if(a.Sj&&a.AM)a.AM=!1;else{var b=!a.Sj;n7(a);a.Sj=b;a.dispatchEvent("ze")}}};t.JVa=function(){if(!d7(this.q)){var a=this.j;a.Sj||(n7(a),a.AM=!0,a.Sj=!0,a.dispatchEvent("ze"))}};t.IVa=function(){if(!d7(this.q)){var a=this.j;a.Sj&&a.AM&&(n7(a),a.dispatchEvent("ze"))}};
t.Gbb=function(a){a.stopPropagation()};t.$Ia=function(a){var b=k7(this,a);a=i7(this.k,this.A,b);if(!b||!a)return"";b=h7(this.A,b);a=ow(a,b).getDisplayValue();500<a.length&&(a=a.substring(0,499),a+="\u2026");return a};t.hLa=function(){var a;a=this.q;var b=a.j.getLinkedDoco();if(a=a.k.k[b]||null||"")(a=k7(this,a))?(b=h7(this.A,a),zUb(this.j,a,b)):T.Os.fireAction()};t.qSa=function(){var a=SD(this.k);yUb(this,a,Hw(a))};t.xSa=function(){BUb(this,!1)};t.ySa=function(){BUb(this,!0)};
function BUb(a,b){for(var c=CUb(a,b),d=qx(a.k),e=SD(a.k),f=Hw(e),h=OD(a.B,e),f=eUb(h,f,b),l=d;!f&&null!==l&&(l=c(l),e=l.Vb(),h=OD(a.B,e),f=eUb(h,null,b),l=l.Ld,l!=d););f&&null!==l&&(c=hUb(h,f)[0],St(a.k,l,A(a.Jbb,a,e,c,f)))}function CUb(a,b){var c;c=b?A(a.k.xS,a.k):A(a.k.uS,a.k);return function(a){return c(a,0,!0,!0)}}t.Jbb=function(a,b,c){zUb(this.j,b,c);Lw(a,c)};
t.J=function(){delete this.C;delete this.Ea;delete this.F;delete this.L;delete this.q;delete this.B;delete this.A;delete this.Ta;delete this.k;delete this.wa;M(this.R);delete this.R;M(this.O);delete this.O;M(this.j);delete this.j;M(this.H);delete this.H;wUb.G.J.call(this)};function l7(a,b,c){N.call(this,a);this.docos=b;this.o=b.length?b[0]:null;this.Ea=c||null}B(l7,N);function DUb(){O.call(this);this.j=new gd}B(DUb,O);t=DUb.prototype;t.dG=null;t.DH=null;t.Bq=null;t.Sj=!1;t.AM=!1;function zUb(a,b,c){n7(a);a.Bq=b;a.DH=c;a.dispatchEvent(new l7("we",[b],c))}function AUb(a){a.Sj||a.Bq||n7(a);a.dispatchEvent("De")}t.reset=function(){n7(this);this.dispatchEvent("Be")};function n7(a){a.dG=null;a.j.clear();a.DH=null;a.Bq=null;a.Sj=!1;a.AM=!1}t.J=function(){delete this.dG;delete this.j;delete this.DH;delete this.Bq;DUb.G.J.call(this)};function EUb(){vo.call(this,305,null)}B(EUb,vo);EUb.prototype.exec=function(){Qn.dispatchEvent("docosTickle")};function o7(a,b){K.call(this);this.k=a;this.j=new R(this);this.j.D(b,"y",this.q);this.j.D(Qn,"docosTickle",this.o)}B(o7,K);o7.prototype.q=function(a){!Go(a.q)&&Go(a.j)&&this.k.sync()};o7.prototype.o=function(){this.k.sync()};o7.prototype.J=function(){delete this.k;M(this.j);delete this.j;o7.G.J.call(this)};function FUb(a,b,c,d,e,f,h,l){mB.call(this,a,b,c,d,e,f,h,2,0,l)}B(FUb,mB);FUb.prototype.Wa=function(a){return oDa(this,a,"range-border cell-border waffle-docos-target-cell-border")};function GUb(a,b,c,d,e,f,h){O.call(this);this.q=a;this.Ea=b;this.A=c;this.o=d;this.C=e;this.j=f;this.I=b.R;this.k=b.j;this.F=b.A;this.H=g7.getInstance();this.wa=h||mh();this.B=new gd;this.L=new gd;this.Y=new gd;this.O=new gd;this.R=new R(this);HUb(this);this.R.D(this.k,"a",this.Nbb).D(this.j,"te",this.gMa).D(this.j,"ue",this.jMa).D(this.j,"se",this.eMa).D(this.j,"ve",this.ZNa).D(this.j,"we",this.Kbb).D(this.j,"De",this.Mbb).D(this.j,"Be",this.Lbb).D(this.j,"ye",this.qOa).D(this.j,"Ce",this.BUa).D(this.j,
"re",this.XNa).D(this.j,"Ae",this.$Na).D(this.j,"xe",this.aOa).D(this.j,"ze",this.tTa);IUb(this)}B(GUb,O);t=GUb.prototype;t.Dr=null;t.G1="none";t.s6=500;t.dO=!1;t.aOa=function(){p7(this)};t.XNa=function(a){var b=a.o;b&&JUb(this,[b]);KUb(this,a.o)};t.$Na=function(a){var b=a.o;b&&LUb(this,[b]);KUb(this,a.o)};function KUb(a,b){var c=i7(a.k,a.F,b);if(c){var d=OD(a.I,c);pVa(a.o,c.qb(),gUb(d).length)}else MUb(a)}t.tTa=function(){p7(this);this.j.Sj&&NUb(this)};t.jMa=function(){p7(this)};
t.eMa=function(a){if(a.o){var b=a.o;this.dO=!0;a=this.q;b=this.H.bd(b);a.j.highlightDoco(a.k.j[b]||0,void 0);this.dO=!1}else p7(this)};t.Mbb=function(){var a=this.j.Bq,b=this.B.isEmpty();this.j.Sj?NUb(this):a?(OUb(this,[a]),b&&!this.B.isEmpty()&&(this.dO=!0,b=this.q,a=this.H.bd(a),b.j.highlightDoco(b.k.j[a]||0,void 0),this.dO=!1)):b||p7(this)};t.Lbb=function(){p7(this)};
function p7(a){a.B.clear();var b=a.q;b.j.flushDocoPositions(kUb(b,{}));b=a.q;b.j.highlightDoco(b.k.j[""]||0,void 0);P(a.C,!1);M(a.Dr);PUb(a);QUb(a);a.j.Sj||RUb(a);iUb(a.o,a.j.Sj);IUb(a)}t.isEmpty=function(){return this.B.isEmpty()&&this.Y.isEmpty()&&this.L.isEmpty()&&this.O.isEmpty()};function IUb(a){var b=lv(a.A);b&&(a.s6=wz(b.k)/2,a.q.setOption(Docos.OptionName.MAX_DOCO_HEIGHT,a.s6))}function QUb(a){Kg(a.Y.sd());a.Y.clear()}function PUb(a){Kg(a.L.sd());a.L.clear()}
function RUb(a){D(a.O.sd(),function(a){om(a,"waffle-docos-target-cell-header")});a.O.clear()}t.gMa=function(a){this.j.Bq||this.j.Sj||(a=a.docos,a.length?OUb(this,a):SUb(this,!1))};function OUb(a,b){d7(a.q)||LUb(a,id(a.B,b).sd());JUb(a,b)}function NUb(a){var b=SD(a.k);b&&(b=OD(a.I,b),OUb(a,gUb(b)),TUb(a),UUb(a))}t.Kbb=function(a){VUb(this,a.o,a.Ea)};
function VUb(a,b,c,d){var e=i7(a.k,a.F,b);if(e){var f=e.qb();if(WUb(a,b)){var h=XUb(a,c),l=function(){YUb(this,c)&&!h.equals(Iw(e))?(Pw(e,h),VUb(this,b,c,d)):(ow(e,c).j&&BI(lv(this.A)).setVisible(!1),ZUb(this,c),OUb(this,[b]),PUb(this),QUb(this),RUb(this),$Ub(this,c),iUb(this.o,this.j.Sj),d&&jh(function(){this.q.j.grabFocus()},0,this),this.dispatchEvent("qe"))};Ue?Vq(pv(eu(a.k,f)),A(e.Lq,e,h)).addCallback(l,a):Xq(pv(eu(a.k,f)),A(e.Lq,e,h),A(l,a),new R)}else rx(a.k,f,A(function(){this.q.j.grabFocus();
VUb(this,b,c,!0)},a))}else a.dispatchEvent("qe")}function ZUb(a,b){var c=SD(a.k),d=lv(a.A);if(!a.dO&&c&&d){var e=d.k,d=d.j,f=Iz(e,"waffle",!1,!1),h=212;if(!e.Tb()){var l=vh("docs-docos-activitybox");l&&Qk(l)&&(h+=f.right-Ok(l).left)}l=aVb(a,b);h=l.x-f.right+h;f=l.y-f.bottom+a.s6;if(!(0>=h&&0>=f)){d=d.j.Ed();for(d=Df(d.y,d.x,d.y,d.x);Jz(e,d).height<f;)Rda(d,1);for(;Jz(e,d).width<h;)Sda(d,1);e=d.height;d=d.width;Qw(c,Bka(c,El(c,Fw(c),d,e)))}}}
function YUb(a,b){var c=SD(a.k);return ew(rl(c,"r"),b.y)&&ew(rl(c,"c"),b.x)}function XUb(a,b){return Al(SD(a.k),b.y,b.x)||Ef(b)}
t.ZNa=function(a){if(!this.j.Sj&&(PUb(this),WUb(this,a.o)&&(SUb(this,!0),this.j.Bq!=a.o))){var b=this.H.bd(a.o),c=this.q;c.j.isDocoResolved(c.k.j[b]||0)?(b=a.Ea,a=lv(this.A),(c=SD(this.k))&&a&&b&&(b=Al(c,b.y,b.x)||Ef(b),b=OH(a,b,"waffle-docos-target-cell-resolved-rect"),Ky(PH(a),b,!0),b.setVisible(!0),this.L.add(b))):(c=a.Ea,a=lv(this.A),(b=SD(this.k))&&a&&c&&(c=Al(b,c.y,c.x)||Ef(c),b=new FUb(b,a.C,a.I,a.B,a.k,a.j,new Uz(c),this.wa),Ky(PH(a),b,!0),this.L.add(b),b.setVisible(!0)))}};
function bVb(a,b){b&&(mm(b,"waffle-docos-target-cell-header"),a.O.add(b))}function $Ub(a,b){var c=lv(a.A),d=SD(a.k);d&&c&&b&&(d=Al(d,b.y,b.x)||Ef(b),d=OH(c,d,"waffle-docos-target-cell-rect"),Ky(PH(c),d,!0),a.Y.add(d),d.setVisible(!0),d.getElement()&&a.R.D(d.getElement(),["click","contextmenu","dblclick","mousedown","mouseup"],function(a){a.Fh=b;c.dispatchEvent(a)}))}function TUb(a){QUb(a);var b={};D(a.B.sd(),function(a){a=h7(this.F,a);var d=a.x+"-"+a.y;b[d]||($Ub(this,a),b[d]=!0)},a)}
function UUb(a){RUb(a);var b=SD(a.k),c=lv(a.A);if(b&&c){var d=c.B,c=c.j,b=OD(a.I,b),e=c.nf("r"),f=c.Qg("r"),h=c.nf("c"),l=c.Qg("c");D(gUb(b),function(a){a=h7(this.F,a);a.x>=h&&a.x<=l&&bVb(this,Iy(d,a.x));a.y>=e&&a.y<=f&&bVb(this,Hy(d,a.y))},a)}}t.BUa=function(){MUb(this)};function MUb(a){var b=mb($b(a.I.j),Number);D(b,function(a){var b=vUb(this.k,a);b&&(b=OD(this.I,b),pVa(this.o,a,gUb(b).length))},a)}t.qOa=function(a){if(a.o){var b=this.H.bd(a.o);a=aVb(this,a.Ea);this.q.j.newDoco(b,a)}};
function JUb(a,b){for(var c={},d=[],e={},f=0;f<b.length;f++){var h=b[f],l=a.H.bd(h),m;m=a;var n=h;if(lv(m.A)&&WUb(m,n)){var p=h7(m.F,n);m=cVb(m,XUb(m,p))?m.j.Sj||m.j.Bq==n||sb(m.j.j.sd(),n):!1}else m=!1;m?(m=h7(a.F,h),n=m=XUb(a,m),n=n.gb()+"-"+n.zb()+"-"+n.ib()+"-"+n.Cb()+"-"+n.k+"-"+n.j,e[n]=e[n]||0,c[l]=aVb(a,m.Ed(),e[n]),e[n]++,a.B.add(h)):d.push(h)}a.B.isEmpty()||SUb(a,!0);cc(c)||(e=a.q,e.j.updateDocoPositions(kUb(e,c)));d7(a.q)||LUb(a,d)}
function LUb(a,b){var c=a.B.lm(b).sd();a.B.Jb(c);c=mb(c,function(a){return this.H.bd(a)},a);c.length&&jUb(a.q,c);a.B.isEmpty()&&SUb(a,!1)}
function aVb(a,b,c){var d=lv(a.A),e=SD(a.k),f=d.k,h=f.Tb(),l=XUb(a,b),m=Kz(f,l),n=c?15*c:0;c=h?m.left-n:m.right+n;var l=m.top+n,p=a.j.Sj;a=qf(a.j.DH,b);var r=ow(e,b).j;p||a||!r?(b=l+125,0<b-wz(f)&&(e=e.Fn("r")-1,Gz(f,b,"r","waffle")>=e&&(l-=50))):(a=BI(d),p=a.jq,APa(d,uw(e,b).Ed()),e=a.C.height?a.Bb:0,b=a.F.height,d=Math.min(WCa.height,e+b),b&&(d=d+30+12,d+=$A.top,d+=$A.bottom),e&&(d+=12,d+=$A.top,d+=$A.bottom),e=d,Pz(a,p),l+=e);m=h?m.right+n+212:m.left-n-212;n=h?0>c-212:c+212>vz(f);e=h?m>vz(f):0>
m;n&&!e&&(c=m);return new Docos.Point(h?Bz(f,c,"c"):c,l)}function WUb(a,b){var c=i7(a.k,a.F,b),d=SD(a.k);return!!c&&c==d}function cVb(a,b){if(!b)return!1;var c=lUb(lv(a.A)),d=!1,e=b.Ed();Pda(b,function(a,b){var l;if(l=a==e.y)l=null!=mH(c,new G(b,a));return l?d=!0:!1});return d}t.Nbb=function(){HUb(this)};function HUb(a){var b=lv(a.A);b&&(a.wa.appendChild(b.QX,a.C),a.q.setOption(Docos.OptionName.LAYOUT_RTL,b.k.Tb()),a.q.setOption(Docos.OptionName.ANCHOR_DIV,a.C),a.q.j.renderAnchorSurface())}
function SUb(a,b){var c,d=a.C.style;c="";"opacity"in d?c=d.opacity:"MozOpacity"in d?c=d.MozOpacity:"filter"in d&&(d=d.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(c=String(d[1]/100));c=""==c?c:Number(c);c=ra(c)?1:c;Qk(a.C)||(c=0);d=b&&1>c?"in":!b&&0<c?"out":"none";"none"==d?(M(a.Dr),P(a.C,b)):a.Dr&&1==a.Dr.ba&&a.G1==d||(M(a.Dr),P(a.C,!0),a.Dr=new Wx(a.C,c,"in"==d?1:0,250),a.G1=d,"out"==d&&ah(a.Dr,"finish",A(a.ZOa,a)),a.Dr.play())}t.ZOa=function(){p7(this);var a=lv(this.A);a&&TH(a)};
t.J=function(){delete this.A;delete this.C;delete this.H;delete this.q;delete this.B;delete this.j;delete this.I;delete this.wa;delete this.G1;delete this.F;delete this.k;delete this.Ea;M(this.Dr);delete this.Dr;QUb(this);PUb(this);RUb(this);M(this.R);delete this.R;GUb.G.J.call(this)};function dVb(a,b,c,d,e,f){K.call(this);this.F=a;this.I=w(b)?b:!0;this.H=w(c)?c:1;this.o=new aq(A(this.GFa,this),d||1E3,e||6E4,f);L(this,this.o);this.A=new Sl(void 0,this);this.j=null;this.B=[];this.q="DCS_Callback"+String(eVb++);this.C=this.k=null}B(dVb,K);var eVb=0;t=dVb.prototype;t.a1=function(){this.j=null;this.o.stop();this.A.callback(this.B)};
t.jfa=function(a){a instanceof Tl||(a instanceof yn&&3==a.code?this.a1():(this.j=null,this.B.push(a instanceof Error?a.message:""),0<this.H--?this.o.start():this.A.errback(this.B)))};t.SZa=function(){this.o.vb()||this.o.start();var a=new Sl;Vl(this.A,a.callback,a.errback,a);return a};
t.GFa=function(){if(this.I){this.k=new oy(this.F);this.k.Hg=1E4;var a=A(this.a1,this);fa(this.q,a,void 0);this.C=this.k.send({callback:this.q},void 0,A(this.jfa,this))}else this.j&&this.j.cancel(),this.j=Jfb(this.F,"dcs_main_js",{timeout:1E4}),Vl(this.j,this.a1,this.jfa,this)};t.J=function(){this.j&&this.j.cancel();this.A.cancel();ea[this.q]&&(ea[this.q]=ha);this.k&&this.C&&this.k.cancel(this.C);dVb.G.J.call(this)};function fVb(){return'<div class="docs-docos-activitybox" aria-label="Comment stream box."><div class="docs-docos-activitybox-inner"></div></div>'};function q7(a,b){Hm.call(this,b);this.j=a}B(q7,Hm);t=q7.prototype;t.$0=null;t.QJ=null;t.AK=null;t.zl=null;t.Gca=!1;t.Ra=function(){q7.G.Ra.call(this);var a=this.P(),b=Bu(fVb,{},{},a);this.X=b;Wh(b,!0);this.QJ=a.getElement("docs-docos-caret");this.$0=di(a,"docs-docos-activitybox-inner",b);this.j&&(mm(b,"docos-enable-new-header"),mm(this.QJ,"docos-enable-new-header"))};
t.ga=function(){this.AK=new ex(this.getElement());this.AK.uj("close-box",27);this.zl=new Om(this.getElement(),"toggle_display");Qm(this.zl,!0);var a=this.zl;Pm(a);a.U4=!1;this.zl.Mfa=!1;S(this).D(this.AK,"shortcut",this.aWa).D(this.zl,"show",this.f1a).D(this.zl,"hide",this.e1a).D(this.zl,"beforeshow",this.d1a).D(this.zl,"beforehide",this.c1a)};t.rb=g("$0");t.f1a=function(){P(this.QJ,!0);this.dispatchEvent("show")};t.e1a=function(){P(this.QJ,!1)};t.d1a=function(){return this.dispatchEvent("beforeshow")};
t.c1a=function(){return this.Gca?!1:this.dispatchEvent("hide")};t.setVisible=function(a){this.zl.setVisible(a)};t.Ia=function(){return!!this.zl&&this.zl.Ia()};t.aWa=function(a){switch(a.j){case "close-box":this.setVisible(!1)}};t.J=function(){M(this.AK);delete this.AK;delete this.QJ;delete this.$0;M(this.zl);delete this.zl;q7.G.J.call(this)};function gVb(a,b,c,d){O.call(this);this.o=c||new nh;this.j=a;this.B=!!b;this.k=new q7(this.j.isDocsStreamHeaderEnabled&&this.j.isDocsStreamHeaderEnabled(),this.o);this.M=new R(this);this.A=new uG(void 0,void 0,!0,RN.getInstance());this.q=d||T.cY;this.j.onReady(A(this.i1a,this))}B(gVb,O);t=gVb.prototype;t.yw=null;t.pla=!1;t.render=ba();
t.i1a=function(){var a=this.o.getElement("docs-docos-commentsbutton");this.yw=TW(null);AA(this.yw,16);this.yw.Qa(a);Md(Qd(),"docosUnreadCommentsEnabled")&&(this.j.setListener(Docos.EventType.UNREAD_COMMENTS,this.w1a,this),this.j.setOption(Docos.OptionName.ENABLE_UNREAD_COMMENTS,!0),T.Os.nd(xr,this.iCa,this));zG(this.A,this.yw,T.Os,bU);T.Os.nd(xr,this.E4a,this);this.k.render(a.parentNode.parentNode);P(this.k.getElement(),!1);T.Os.Z(!0);this.j.setOption(Docos.OptionName.PANE_DIV,this.k.rb());this.j.setOption(Docos.OptionName.PANE_KB_DIV,
this.k.getElement());this.j.renderPaneSurface();this.j.setListener(Docos.OptionName.DIALOG_OPENED,A(this.zoa,this));this.j.setListener(Docos.OptionName.DIALOG_CLOSED,A(this.zoa,this));this.j.setOption(Docos.OptionName.SORT_PANE,!0);this.j.setOption(Docos.OptionName.STREAM_BUTTON,a);Docos.EventType.CREATE_DRAFT&&(this.j.setListener(Docos.EventType.CREATE_DRAFT,this.tEa,this),this.q.nd(vr,this.yoa,this),this.yoa(new esa("enabled",this.q.isEnabled(),!1)));this.B||this.j.setListener(Docos.EventType.NETWORK_ERROR,
this.$0a,this);this.M.D(this.k,["show","hide"],this.b0a)};t.zoa=function(a){this.k.Gca=a.type==Docos.OptionName.DIALOG_OPENED};t.yoa=function(a){this.j.setOption(Docos.OptionName.ENABLE_COMMENT_BUTTON,a.newValue)};t.tEa=function(){this.k.setVisible(!1);this.q.fireAction()};t.E4a=function(){var a=this.k,b;if(b=a.zl)b=a.zl,b=!(b.nB||150>za()-b.d6);b&&a.zl.setVisible(!0)};
function hVb(a,b){if(0>b)throw Error("Number of unread comments cannot be negative");vA(a.yw,"docs-docos-commentsbutton-unread",0<b);var c=a.o.getElement("docs-docos-commentsbutton");a.o.bj(c,String(b))}t.w1a=function(){var a=this.j.getUnreadCommentsCount();hVb(this,a)};t.iCa=function(){hVb(this,0);this.j.ackUnreadComments()};
t.$0a=function(){if(!this.pla&&T.Dm.isEnabled()){if(this.j.hasPendingContent()){var a=fp("Failed to post comment due to a network error.","warning",!0);dp.getInstance().postMessage(a)}this.j.setOption(Docos.OptionName.FATAL_READONLY,!0);this.j.setOption(Docos.OptionName.SHOW_ERRORS,!0);T.cY.Z(!1,"docos-fatal-reason");this.pla=!0}};t.b0a=function(a){a="show"==a.type;this.j.setOption(Docos.OptionName.SORT_PANE,!a);this.yw.Ub(a);a?this.j.grabFocus():this.dispatchEvent("activity-box-closed")};
t.J=function(){M(this.yw);delete this.yw;M(this.M);delete this.M;M(this.k);delete this.k;M(this.A);delete this.A;delete this.j;gVb.G.J.call(this)};function iVb(){K.call(this)}B(iVb,Bn);t=iVb.prototype;t.KHa=function(){return dVb};t.iIa=function(){return o7};t.kIa=function(){return gVb};t.fIa=function(){return wUb};t.gIa=function(){return DUb};t.hIa=function(){return EUb};t.jIa=function(){return GUb};Nn("docos",iVb);
